<!DOCTYPE html>
<html lang="en">
    {% load staticfiles %}
    <link href="{{ STATIC_URL }}min/plugin-min.css" type="text/css" rel="stylesheet">
    <link href="{{ STATIC_URL }}min/custom-min.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/materialize.min.js"></script>
    <script src="{{ STATIC_URL }}js/skills_tutorials.js" type="text/javascript"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel=""/>
    <title></title>
    <style>
        label.choice {
            font-size: 20px;
        }

        .card-content {
            font-size: 40px;
        }

        .question_card {
            font-size: 40px;
        }

        .chip {
            position: relative;
        }
        .nav-wrapper{

        }

        .chip_holder {
            position: fixed;
            top: 150px;
            right: 50px;
        }

        .container {
            position: absolute;
            left: 30%;
        }
        #timer{
            position:fixed;
            right: 50px;
        }

        #site_suggestions {
        / / display : none;
            top: 100px;
            right: 50px;
        }

    </style>
    <script type="text/javascript">
        jQuery(window).on('beforeunload', function()
        {
            alert('Leaving this page will lose your changes. Are you sure?');
        });

        questions=[];
        {% for question in questions %}
            question=[];
            question["skill"]='{{ question.skill }}';
            question["question"]='{{ question.question }}';
            question["choices"]=[];
            {% for choice in question.choices %}
                question["choices"].push('{{ choice }}');
            {% endfor %}

            question["correct"]='{{ question.correct }}';
            questions.push(question);

        {% endfor %}

        quiz = [{
            "skill": "Javascript",
            "question": "Which is the storage that allows the caching of web pages and their associated resources?",
            "choices": [
                "Web Databases", "FileSystem API", "Offline Web Applications", "All of the mentioned"],
            "correct": "Offline Web Applications"
        },
            {
                "skill": "abc",
                "question": "something?",
                "choices": ["a", "b", "c", "d"], "correct": "a"
            }];
        quiz=questions;
        var currentQuestion = 0, score = 0, wrong_index = 0, submt = true, picked;
        var wrong = new Array();
        //adding the choices dynamically
        function init(minutes) {
            var seconds = 60;
            var mins = minutes;

            function tick() {
                var counter = document.getElementById("timer");
                var current_minutes = mins - 1;
                seconds--;
                counter.innerHTML = "Time Left = " + current_minutes.toString() + ":" + (seconds < 10 ? "0" : "") + String(seconds);
                if (seconds > 0) {
                    setTimeout(tick, 1000);
                }
                else {
                    if (mins > 1) {
                        setTimeout(function () {
                            countdown(min - 1);
                        })
                    }
                }
                if (current_minutes <= 0 && seconds <= 0) {
                    alert("Timeout!");
                }
            }

            tick();
            addChoices(quiz[currentQuestion]['choices']);
        }
        function getRadioValue(theRadioGroup) {
            var elements = document.getElementsByName(theRadioGroup);
            for (var i = 0, l = elements.length; i < l; i++) {
                if (elements[i].checked) {
                    return elements[i].value;
                }
            }
        }
        function addChoices(choices) {
            $('.question_card').text(quiz[currentQuestion]['question']);
            $('.card-title').text(quiz[currentQuestion]['skill']);

            $('label[for=test1]').html(choices[0]);
            document.getElementById("test1").value = choices[0];

            $('label[for=test2]').html(choices[1]);
            document.getElementById("test2").value = choices[1];

            $('label[for=test3]').html(choices[2]);
            document.getElementById("test3").value = choices[2];

            $('label[for=test4]').html(choices[3]);
            document.getElementById("test4").value = choices[3];
            setupButtons();
        }
        function nextQuestion() {
            submt = true;
            /*$('.question_card').text(quiz[currentQuestion]['question']);
             $('.card-title').text(quiz[currentQuestion]['skill']);
             addChoices(quiz[currentQuestion]['choices']);*/
            //clearing the radio button selection
            //added now from here:
            $('.response_from_server').html('');
            $('input[name=group1]').attr('checked', false);
            //resetting the questions
            $('.question_card').text(quiz[currentQuestion]['question']);
            $('.card-title').text(quiz[currentQuestion]['skill']);
            //resetting the choices
            addChoices(quiz[currentQuestion]['choices']);
        }
        function setupButtons() {
            if (submt) {
                submt = false;
                $('input[name=group1]').on('click', function () {
                    //alert("clicked!");
                    picked = getRadioValue("group1");
                    //alert(picked);
                });
                $('#btn').on('click', function () {
                    $('.choice').off('click');
                    $(this).off('click');
                    processQuestion(picked);
                })
            }
        }
        function processQuestion(choice) {
            if (picked == quiz[currentQuestion]['correct']) {
                score++;
                //$('.response_from_server').text("CORRECT!");
                //alert("correct");
            }
            else {
                // alert("incorrect");
                //$('.response_from_server').text("INCORRECT!");
                wrong[wrong_index] = quiz[currentQuestion]['skill'];
                wrong_index++;
            }
            currentQuestion++;
            if (currentQuestion == quiz.length) {
                endQuiz();
            }
            else {
                $(this).off('click');
                nextQuestion();
            }
        }
        function endQuiz() {
            $('.question_card').empty();
            $('.card-title').remove();
            $('.response_from_server').remove();

            $('.question_card').text("You got " + score + " out of " + quiz.length + " correct.");
            $(document.createElement('h2')).css({
                'text-align': 'center',
                'font-size': '4em'
            }).text(Math.round(score / quiz.length * 100) + '%').insertAfter('.question_card');

            var list = document.getElementsByClassName("Rbuttons");
            for (var i = list.length - 1; 0 <= i; i--)
                if (list[i] && list[i].parentElement)
                    list[i].parentElement.removeChild(list[i]);
            //alert(wrong);
            //document.getElementById("site_suggestions").style.display = "block";
            //$('#site_suggestions').css("display", "block");
            for (var v = 0; v < wrong.length; v++) {
                //alert(wrong[v]);
                var wrong_list = skills_reco[wrong[v]];
                //alert(wrong_list);
                holder_list = document.getElementsByClassName("chip_holder");
                holder = holder_list[0];
                new_div = document.createElement("div");
                new_div.innerHTML = wrong[v];
                new_div.className = "chip";
                holder.appendChild(new_div);
                //alert("appened child!");
                new_a = document.createElement("a");
                new_a.setAttribute("href", wrong_list[0]);
                new_div.appendChild(new_a);
                new_img = document.createElement("img");
                new_img.setAttribute("src", wrong_list[1]);
                new_a.appendChild(new_img);

            }
            $('#btn').on('click', function () {
                    alert("LOAL");
                    document.getElementById("nigga").click();
                });
//document.getElementById("nigga").click

            //$('.chip').css("display","block");
        }

    </script>
</head>
<body onload="init(1)"> <!--CHANGE THIS LATER ON-->

<nav>
    <div class="nav-wrapper teal lighten-2">
        <a href="#" class="brand-logo">JustTheJob</a>

        <div id="timer" class="fixed" align="right" style="width:1200px; font-size:120%;"> Time Left</div>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
        </ul>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col s14 m7">
            <div class="card blue-grey darken-1">
                <div class="card-content white-text">
                    <span class="card-title">Question</span>

                    <p><span class="question_card">The question comes here</span></p>

                    <p><span class="response_from_server"></span></p>
                </div>
            </div>
        </div>
    </div>
    <!-- radio buttons-->
    <!-- put all this in a form after this, when shifted to server side -->
    <p class="Rbuttons">
        <input name="group1" type="radio" id="test1" value=""/>
        <label class="choice" for="test1"></label>
    </p>

    <p class="Rbuttons">
        <input name="group1" type="radio" id="test2" value=""/>
        <label class="choice" for="test2"></label>
    </p>

    <p class="Rbuttons">
        <input name="group1" type="radio" id="test3" value=""/>
        <label class="choice" for="test3"></label>
    </p>

    <p class="Rbuttons">
        <input name="group1" type="radio" id="test4" value=""/>
        <label class="choice" for="test4"></label>
    </p>
    <button class="btn waves-effect waves-light" id="btn" type="submit" name="action">
        <i class="material-icons">send</i></button>
</div>

<div class="chip_holder">

</div>

<!--ending radio options-->

<form method="POST" action="test" style="display: none" id="forme">
    <input type="hidden" name="type" value="quiz"/>
    <input type="hidden" name="score" value="0" id="score"/>
    <input type="hidden" name="job_id" value="{{ job_id }}">
    <button type="submit" class="btn waves-effect waves-light" id="nigga" >DONE</button>
</form>

</body>
</html>